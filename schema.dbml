// -----------------------------------------------------------------------------
// GLOBAL SCHEMA (Shared Data, No PII)
// -----------------------------------------------------------------------------

enum global.region {
  ind1
  usa1
  deu1
  sgp1
  // more in future
}

enum global.hub_user_status {
  active
  disabled
  deleted
}

enum global.language {
  en_IN
  ta
  // Standard ISO codes
}

Table global.hub_users {
  hub_user_global_id uuid [primary key, not null]
  handle text [not null, unique, note: 'Globally unique handle']
  email_hash bytea [not null, unique, note: 'SHA-256 hash of the primary email for lookup']
  status global.hub_user_status [not null]
  preferred_language global.language [not null]
  created_at timestamp [default: `now()`]

  // No PII here. Profile data is in regional tables.
}

Table global.hub_user_email_history {
  email_hash bytea [not null]
  hub_user_global_id uuid [not null]
  valid_from timestamp [not null]
  valid_to timestamp [note: 'NULL means current owner']

  indexes {
    (email_hash, valid_from) [pk]
  }

}

Ref: global.hub_user_email_history.hub_user_global_id > global.hub_users.hub_user_global_id

enum global.org_status {
  onboard_pending
  operational
  defunct
}

Table global.orgs {
  org_id uuid [primary key]
  org_status global.org_status
  created_at timestamp [default: `now()`]
}

Table global.org_names {
  org_id uuid [not null]
  locale text [not null]
  value text [not null]

  indexes {
    (org_id, locale) [pk]
  }

}

Ref: global.org_names.org_id > global.orgs.org_id

enum global.org_auth_type {
  email_password
  saml
  oauth
}

Table global.org_auth_types {
  org_id uuid [not null]
  auth_type global.org_auth_type
  sso_provider text [note: 'e.g. GOOGLE, OKTA, AZURE_AD']

  indexes {
    (org_id, auth_type) [pk]
  }

}

Ref: global.org_auth_types.org_id > global.orgs.org_id

Table global.org_supported_regions {
  org_id uuid [not null]
  region global.region

  indexes {
    (org_id, region) [pk]
  }

}

Ref: global.org_supported_regions.org_id > global.orgs.org_id

enum global.org_domain_verification_state {
  unverified
  verified
}

Table global.org_domains {
  domain text [primary key]
  org_id uuid [not null]
  verification_state global.org_domain_verification_state
  last_verified_at timestamp
}

Ref: global.org_domains.org_id > global.orgs.org_id

Table global.org_domain_history {
  domain text [not null]
  org_id uuid [not null]
  valid_from timestamp [not null]
  valid_to timestamp

  indexes {
    (domain, valid_from) [pk]
  }

}

Ref: global.org_domain_history.org_id > global.orgs.org_id

// --- Agencies (Global) ---

enum global.agency_status {
  onboard_pending
  operational
  defunct
}

Table global.agencies {
  agency_id uuid [primary key]
  agency_status global.agency_status
  created_at timestamp [default: `now()`]
}

Table global.agency_names {
  agency_id uuid [not null]
  locale text [not null]
  value text [not null]

  indexes {
    (agency_id, locale) [pk]
  }

}

Ref: global.agency_names.agency_id > global.agencies.agency_id

Table global.agency_auth_types {
  agency_id uuid [not null]
  auth_type global.org_auth_type
  sso_provider text

  indexes {
    (agency_id, auth_type) [pk]
  }

}

Ref: global.agency_auth_types.agency_id > global.agencies.agency_id

Table global.agency_supported_regions {
  agency_id uuid [not null]
  region global.region

  indexes {
    (agency_id, region) [pk]
  }

}

Ref: global.agency_supported_regions.agency_id > global.agencies.agency_id

Table global.agency_domains {
  domain text [primary key]
  agency_id uuid [not null]
  verification_state global.org_domain_verification_state
  last_verified_at timestamp
}

Ref: global.agency_domains.agency_id > global.agencies.agency_id

Table global.agency_domain_history {
  domain text [not null]
  agency_id uuid [not null]
  valid_from timestamp [not null]
  valid_to timestamp

  indexes {
    (domain, valid_from) [pk]
  }

}

Ref: global.agency_domain_history.agency_id > global.agencies.agency_id

// -----------------------------------------------------------------------------
// REGIONAL SCHEMA (PII, Operational Data)
// -----------------------------------------------------------------------------

// --- Hub Users (Regional) ---

Table regional.hub_users {
  hub_user_id uuid [primary key, note: 'Regional ID']
  hub_user_global_id uuid [not null, note: 'Link to global identity']
  email_address text [not null, unique, note: 'Primary login email']
  password_hash bytea [note: 'Only if using email/password']
  created_at timestamp
}

Ref: regional.hub_users.hub_user_global_id > global.hub_users.hub_user_global_id

Table regional.hub_user_profiles {
  hub_user_id uuid [primary key]
  first_name text
  last_name text
  title text
  bio text
  avatar_url text
  current_location text
  updated_at timestamp
}

Ref: regional.hub_user_profiles.hub_user_id - regional.hub_users.hub_user_id

Table regional.hub_user_work_emails {
  hub_user_id uuid [not null]
  email_address text [not null, note: 'Additional work email for verification, not login']
  verified_at timestamp

  indexes {
    (hub_user_id, email_address) [pk]

  }

}

Ref: regional.hub_user_work_emails.hub_user_id > regional.hub_users.hub_user_id

Table regional.hub_user_experiences {
  experience_id uuid [primary key]
  hub_user_id uuid [not null]
  company_name text [not null]
  title text [not null]
  start_date date [not null]
  end_date date
  is_current boolean
  description text
}

Ref: regional.hub_user_experiences.hub_user_id > regional.hub_users.hub_user_id

Table regional.hub_user_educations {
  education_id uuid [primary key]
  hub_user_id uuid [not null]
  institution_name text [not null]
  degree text
  field_of_study text
  start_date date
  end_date date
}

Ref: regional.hub_user_educations.hub_user_id > regional.hub_users.hub_user_id

// --- Social Graph ---

enum regional.connection_status {
  pending
  accepted
  rejected
}

Table regional.connections {
  requester_id uuid [not null]
  recipient_id uuid [not null]
  status regional.connection_status [not null]
  created_at timestamp [default: `now()`]
  updated_at timestamp

  indexes {
    (requester_id, recipient_id) [pk]
  }

}

Ref: regional.connections.requester_id > regional.hub_users.hub_user_id
Ref: regional.connections.recipient_id > regional.hub_users.hub_user_id

Table regional.follows {
  follower_id uuid [not null]
  followee_id uuid [not null] // Can be user or company (polymorphic in app logic, or separate tables)
  followee_type text [note: 'USER or COMPANY']
  created_at timestamp

  indexes {
    (follower_id, followee_id, followee_type) [pk]
  }

}

Ref: regional.follows.follower_id > regional.hub_users.hub_user_id

// --- Content ---

enum global.hub_post_status {
  draft
  published
  unpublished
}

Table regional.hub_user_posts {
  post_id uuid [primary key]
  hub_user_id uuid [not null]
  content text
  status global.hub_post_status
  created_at timestamp [not null]
  updated_at timestamp [not null]
}

Ref: regional.hub_user_posts.hub_user_id > regional.hub_users.hub_user_id

// --- Org Users ---

enum regional.org_user_role {
  admin
  recruiter
  hiring_manager
  interviewer
}

Table regional.org_users {
  org_user_id uuid [primary key]
  org_id uuid [not null]
  email_address text [not null]
  role regional.org_user_role [not null]
  associated_agency_id uuid [note: 'If this user is an external recruiter from an agency']
  status text [note: 'active, disabled']
}

Ref: regional.org_users.org_id > global.orgs.org_id
Ref: regional.org_users.associated_agency_id > global.agencies.agency_id

// --- Hiring / Jobs ---

enum regional.opening_state {
  draft
  active
  suspended
  closed
}

Table regional.openings {
  opening_id uuid [primary key]
  org_id uuid [not null]
  title text [not null]
  description text
  hiring_manager_id uuid [not null]
  state regional.opening_state
  recruiter_id uuid [not null, note: 'Assigned recruiter (can be internal or agency-linked)']
  created_at timestamp

  // Pipeline config could be JSONB or separate tables
  pipeline_config jsonb
}

Ref: regional.openings.org_id > global.orgs.org_id
Ref: regional.openings.hiring_manager_id > regional.org_users.org_user_id
Ref: regional.openings.recruiter_id > regional.org_users.org_user_id

enum regional.application_state {
  applied
  shortlisted
  rejected_at_application
  withdrawn
}

Table regional.applications {
  application_id uuid [primary key]
  opening_id uuid [not null]
  hub_user_global_id uuid [not null, note: 'Applicant ID']
  sourcing_agency_id uuid [note: 'If submitted by an agency']
  state regional.application_state [not null]
  created_at timestamp [default: `now()`]
  updated_at timestamp

  indexes {
    (opening_id, hub_user_global_id) [unique]
  }

}

Ref: regional.applications.opening_id > regional.openings.opening_id

Ref: regional.applications.hub_user_global_id > global.hub_users.hub_user_global_id
Ref: regional.applications.sourcing_agency_id > global.agencies.agency_id

enum regional.candidacy_state {
  active
  rejected_after_interview
  candidate_no_show
  candidate_unsuitable
  candidate_withdrew
  candidate_offered
  candidate_rejected_offer
  candidate_accepted_offer
  hired
}

Table regional.candidacies {
  candidacy_id uuid [primary key]
  application_id uuid [not null, unique]
  state regional.candidacy_state [not null]
  current_stage text [note: 'e.g. Technical Interview']
  created_at timestamp
  updated_at timestamp
}

Ref: regional.candidacies.application_id - regional.applications.application_id

enum regional.interview_state {
  scheduled
  completed
  cancelled
  no_show
  rescheduled
}

Table regional.interviews {
  interview_id uuid [primary key]
  candidacy_id uuid [not null]
  scheduled_at timestamp [not null]
  state regional.interview_state [not null]
  feedback text
}

Ref: regional.interviews.candidacy_id > regional.candidacies.candidacy_id

Table regional.interviewers {
  interview_id uuid [not null]
  org_user_id uuid [not null]
  rsvp_status text

  indexes {
    (interview_id, org_user_id) [pk]
  }

}

Ref: regional.interviewers.interview_id > regional.interviews.interview_id
Ref: regional.interviewers.org_user_id > regional.org_users.org_user_id

// --- Agency Users & Workflows ---

enum regional.agency_user_role {
  admin
  recruiter
}

Table regional.agency_users {
  agency_user_id uuid [primary key]
  agency_id uuid [not null]
  email_address text [not null]
  role regional.agency_user_role [not null]
  status text [note: 'active, disabled']
}

Ref: regional.agency_users.agency_id > global.agencies.agency_id

Table regional.employer_agencies {
  org_id uuid [not null]
  agency_id uuid [not null]
  status text [note: 'active, suspended']
  created_at timestamp [default: `now()`]

  indexes {
    (org_id, agency_id) [pk]
  }

}

Ref: regional.employer_agencies.org_id > global.orgs.org_id
Ref: regional.employer_agencies.agency_id > global.agencies.agency_id

Table regional.opening_sourcing_agencies {
  opening_id uuid [not null]
  agency_id uuid [not null]
  created_at timestamp [default: `now()`]

  indexes {
    (opening_id, agency_id) [pk]
  }

}

Ref: regional.opening_sourcing_agencies.opening_id > regional.openings.opening_id
Ref: regional.opening_sourcing_agencies.agency_id > global.agencies.agency_id





Table regional.agency_private_notes {
  note_id uuid [primary key]
  agency_id uuid [not null]
  author_id uuid [not null]
  hub_user_global_id uuid [not null]
  content text
  created_at timestamp [default: `now()`]
  updated_at timestamp
}

Ref: regional.agency_private_notes.agency_id > global.agencies.agency_id
Ref: regional.agency_private_notes.author_id > regional.agency_users.agency_user_id
Ref: regional.agency_private_notes.hub_user_global_id > global.hub_users.hub_user_global_id

// --- Cross-Region Indexes (Stored in HubUser's Home Region) ---

Table regional.application_index {
  hub_user_global_id uuid [not null]
  application_id uuid [not null]
  opening_id uuid [not null]
  target_region global.region [not null, note: 'Region where the application actually exists']
  state regional.application_state
  created_at timestamp

  indexes {
    (hub_user_global_id, application_id) [pk]
  }

}

Ref: regional.application_index.hub_user_global_id > global.hub_users.hub_user_global_id

Table regional.candidacy_index {
  hub_user_global_id uuid [not null]
  candidacy_id uuid [not null]
  target_region global.region [not null]
  state regional.candidacy_state
  updated_at timestamp

  indexes {
    (hub_user_global_id, candidacy_id) [pk]
  }

}

Ref: regional.candidacy_index.hub_user_global_id > global.hub_users.hub_user_global_id
